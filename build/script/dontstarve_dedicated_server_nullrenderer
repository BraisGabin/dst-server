#!/usr/bin/env bash

if [ `whoami` != "$STEAM_USER" ]; then
	exec gosu $STEAM_USER $0 "$@"
fi

# TODO here we are going to trap the signals

cd $DST_HOME/bin

# We must have at least one writer
sleep infinity > $DSTA_HOME/console &

exec ./dontstarve_dedicated_server_nullrenderer \
	-console \
	-backup_logs \
	-persistent_storage_root `dirname $CLUSTER_PATH` \
	-conf_dir "." \
	-cluster `basename $CLUSTER_PATH` \
	-shard "$SHARD_NAME" \
	"$@" < $DSTA_HOME/console
